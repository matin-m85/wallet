# ==============================
# ğŸ“¦ Dockerfile for API Gateway
# ==============================

# ğŸ§± Stage 1: Build Go binary
FROM docker.arvancloud.ir/golang:1.24.2 AS builder

WORKDIR /app

# ğŸ“š Download Go dependencies
COPY go.mod go.sum ./
RUN go mod download

# ğŸ“¥ Copy source code
COPY . .

# âš™ï¸ Build binary
ENV CGO_ENABLED=0 GOOS=linux GOARCH=amd64
RUN go build -o api-gateway ./cmd/main.go

# ==============================
# ğŸª¶ Stage 2: Runtime
# ==============================
FROM docker.arvancloud.ir/alpine:latest

WORKDIR /app

# ğŸ“¦ Copy compiled binary
COPY --from=builder /app/api-gateway .

# ğŸ” Make executable
RUN chmod +x ./api-gateway

# ğŸŒ Expose port
EXPOSE 8080

# ğŸš€ Run service
CMD ["./api-gateway"]
