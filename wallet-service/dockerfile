# ==============================
# ğŸ’° Dockerfile for Wallet Service
# ==============================

# ğŸ§± Stage 1: Build Go binary
FROM docker.arvancloud.ir/golang:1.24.2 AS builder

WORKDIR /app

# ğŸ“š Copy dependencies for better caching
COPY go.mod go.sum ./
RUN go mod download

# ğŸ“¥ Copy full source
COPY . .

# âš™ï¸ Build static binary for Alpine
ENV CGO_ENABLED=0 GOOS=linux GOARCH=amd64
RUN go build -o wallet-service ./cmd/main.go

# ==============================
# ğŸª¶ Stage 2: Runtime
# ==============================
FROM docker.arvancloud.ir/alpine:latest

WORKDIR /app

# ğŸ“¦ Copy compiled binary
COPY --from=builder /app/wallet-service .

# ğŸ” Make executable
RUN chmod +x /app/wallet-service

# ğŸŒ Expose port
EXPOSE 8081

# ğŸš€ Start service
CMD ["./wallet-service"]
